<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Supabase Einnahmen Tool</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body {
            background: #0c0c0f;
            color: #d4aaff;
            padding: 20px;
            font-family: 'Arial', sans-serif;
        }
        .neon-box {
            border: 1px solid #a020f0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px #a020f0;
            background: #12121a;
        }
        input, table, .btn {
            box-shadow: 0 0 8px #a020f0;
        }
        .btn-neon {
            background: #a020f0;
            color: white;
            font-weight: bold;
            border: none;
            box-shadow: 0 0 10px #a020f0;
        }
        .btn-neon:hover {
            box-shadow: 0 0 20px #d080ff;
        }
        table th {
            background: #1a001f;
            color: #e3c6ff;
        }
        .delete-btn {
            cursor: pointer;
            color: #ff4dff;
            font-weight: bold;
        }
        .delete-btn:hover {
            color: #ff99ff;
            text-shadow: 0 0 8px #ff4dff;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="mb-4 text-center">Einnahmen Milane</h1>

    <!-- Eingabe -->
    <div class="neon-box mb-4">
        <h3>Eintrag hinzuf√ºgen</h3>

        <form id="form">
            <input type="text" id="name" class="form-control mb-2" placeholder="Name" required>
            <input type="number" step="0.01" id="betrag" class="form-control mb-3" placeholder="Betrag" required>
            <button class="btn btn-neon w-100">Speichern</button>
        </form>

        <p id="status" class="mt-2"></p>
    </div>

    <!-- Tabelle -->
    <div class="neon-box mb-4">
        <h3>Alle Eintr√§ge</h3>
        <table class="table table-dark table-striped mt-3" id="liste">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Betrag</th>
                    <th>L√∂schen</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Summen -->
    <div class="neon-box">
        <h3>Totals</h3>
        <p><strong>Total:</strong> <span id="total">0.00</span></p>
        <p><strong>40%:</strong> <span id="p40">0.00</span></p>
        <p><strong>60%:</strong> <span id="p60">0.00</span></p>
    </div>
</div>


<script>
// === Supabase verbinden ===
const supabaseClient = supabase.createClient(
    "https://qnpufvlklhpjkuzifzeb.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFucHVmdmxrbGhwamt1emlmemViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzMjAxMTYsImV4cCI6MjA3OTg5NjExNn0.wY7565zw5j5qpoD8OMLa78QmjZ8PG6uhHaBO3xBwmJA"
);

// === Daten Laden ===
async function ladeDaten() {
    const { data, error } = await supabaseClient
        .from("eintraege")
        .select("*")
        .order("id", { ascending: false });

    const tbody = document.querySelector("#liste tbody");
    tbody.innerHTML = "";

    let total = 0;

    if (!error) {
        data.forEach(row => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${row.id}</td>
                <td>${row.name}</td>
                <td>${parseFloat(row.betrag).toFixed(2)}</td>
                <td><span class="delete-btn" onclick="deleteEintrag(${row.id})">üóëÔ∏è</span></td>
            `;

            tbody.appendChild(tr);

            total += parseFloat(row.betrag);
        });
    }

    // Summen berechnen
    document.getElementById("total").textContent = total.toFixed(2);
    document.getElementById("p40").textContent = (total * 0.40).toFixed(2);
    document.getElementById("p60").textContent = (total * 0.60).toFixed(2);
}

// === Eintrag speichern ===
document.getElementById("form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const betrag = document.getElementById("betrag").value;

    const { error } = await supabaseClient
        .from("eintraege")
        .insert([{ name: name, betrag: betrag }]);

    if (error) {
        document.getElementById("status").innerHTML = "‚ùå Fehler: " + error.message;
    } else {
        document.getElementById("status").innerHTML = "‚úÖ Gespeichert!";
        document.getElementById("form").reset();
        ladeDaten();
    }
});

// === L√∂schen Funktion ===
async function deleteEintrag(id) {
    if (!confirm("Diesen Eintrag wirklich l√∂schen?")) return;

    const { error } = await supabaseClient
        .from("eintraege")
        .delete()
        .eq("id", id);

    if (error) {
        alert("Fehler beim L√∂schen: " + error.message);
    } else {
        ladeDaten();
    }
}

// Start
ladeDaten();
</script>

</body>
</html>
